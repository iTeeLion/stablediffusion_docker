version: '3.8'
services:
  sd:
    container_name: sd
    restart: unless-stopped
    tty: true
    user: "${UID:-1000}:${GID:-1000}"
    build:
      context: .
    ports:
      - ${WEBUI_PORT:-7860}:7860
    volumes:
      - "./extensions:/opt/sd/webui/extensions"
      - "./modules:/opt/sd/webui/modules"
      - "./models:/opt/sd/webui/models"
    environment:
      UID: ${UID:-1000}
      GID: ${GID:-1000}
      CLI_ARGS: "--api --enable-insecure-extension-access --allow-code --skip-version-check --opt-channelslast"
    deploy:
      resources:
        reservations:
          devices:
              - driver: nvidia
                device_ids: ['0']
                capabilities: [compute, utility]
                
